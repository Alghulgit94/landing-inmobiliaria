<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mapa Loteamiento - Mega Proyectos</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="assets/css/index.css" />
    <link rel="stylesheet" href="assets/css/mapa.css" />
  </head>
  <body>
    <div class="map-layout">
      <!-- Header -->
      <header class="map-header">
        <a href="index.html" class="map-back-button" data-i18n-attr="aria-label:mapa.back_button" aria-label="Volver a inicio">
          <span class="back-arrow">‚Üê</span>
        </a>
        <h1 class="map-title" data-i18n="mapa.header.title">Loteamiento Colonia Independencia</h1>

        <!-- Language Selector (Desktop) -->
        <div class="language-selector-wrapper language-selector-wrapper--desktop">
          <select
            id="language-selector"
            class="language-selector"
            aria-label="Seleccionar idioma / Select language / Sprache w√§hlen"
          >
            <option value="es" data-flag="üá™üá∏" selected>üá™üá∏</option>
            <option value="en" data-flag="üá∫üá∏">üá∫üá∏</option>
            <option value="de" data-flag="üá©üá™">üá©üá™</option>
          </select>
        </div>
      </header>

      <!-- Map Content Container -->
      <div class="map-content">
        <!-- Left Sidebar - Info Panel -->
        <aside class="sidebar-left" id="sidebarLeft">
        <div class="sidebar-header">
          <h2 class="sidebar-title" data-i18n="mapa.sidebar.title">Informaci√≥n del Lote</h2>
          <button class="sidebar-close" id="sidebarClose" data-i18n-attr="aria-label:mapa.sidebar.close" aria-label="Cerrar">
            &times;
          </button>
        </div>

        <div class="sidebar-content">
          <!-- Empty State -->
          <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">üó∫Ô∏è</div>
            <h3 data-i18n="mapa.sidebar.empty_state.title">Selecciona un Lote</h3>
            <p data-i18n="mapa.sidebar.empty_state.description">
              Haz clic en cualquier lote del mapa para ver informaci√≥n
              detallada, incluyendo precio, dimensiones y estado de
              disponibilidad.
            </p>
          </div>

          <!-- Parcel Information -->
          <div class="parcel-info" id="parcelInfo">
            <div class="parcel-image parcel-carousel">
              <div class="parcel-carousel__track" id="parcelCarouselTrack">
                <!-- Images will be dynamically inserted here -->
              </div>
              <button class="parcel-carousel__arrow parcel-carousel__arrow--prev" id="parcelPrevBtn" data-i18n-attr="aria-label:mapa.sidebar.buttons.prev_image" aria-label="Imagen anterior">
                <span>‚Äπ</span>
              </button>
              <button class="parcel-carousel__arrow parcel-carousel__arrow--next" id="parcelNextBtn" data-i18n-attr="aria-label:mapa.sidebar.buttons.next_image" aria-label="Siguiente imagen">
                <span>‚Ä∫</span>
              </button>
              <div class="parcel-carousel__dots" id="parcelCarouselDots">
                <!-- Dot indicators will be dynamically inserted here -->
              </div>
            </div>

            <span class="status-badge" id="parcelStatusBadge" data-i18n="mapa.sidebar.status.disponible">Disponible</span>

            <div class="info-section">
              <div class="info-label" data-i18n="mapa.sidebar.labels.name">Nombre</div>
              <div class="info-value" id="parcelName">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label" data-i18n="mapa.sidebar.labels.description">Descripci√≥n</div>
              <div class="info-value" id="parcelDescription">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label" data-i18n="mapa.sidebar.labels.sides">Lados</div>
              <div class="info-value" id="parcelLados">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label" data-i18n="mapa.sidebar.labels.coordinates">Coordenadas</div>
              <div class="info-value" id="parcelCoordinates">N/A</div>
            </div>

           <div class="info-section">
              <div class="info-label" data-i18n="mapa.sidebar.labels.area">√Årea (m¬≤)</div>
              <div class="info-value" id="parcelArea">N/A</div>
            </div>

            <div class="price-display">
              <div class="info-label" data-i18n="mapa.sidebar.labels.price">Precio</div>
              <div class="price-amount" id="parcelPrice" data-i18n="mapa.sidebar.labels.consult">Consultar</div>
            </div>

            <button class="reserve-btn" id="reserveBtn" data-i18n="mapa.sidebar.buttons.reserve">Reservar Lote</button>
          </div>
        </div>
      </aside>

      <!-- Center - Map Container -->
      <main class="map-container">
        <div id="map"></div>
        
        <!-- Tooltip Container -->
        <div id="parcelTooltip" class="parcel-tooltip" role="tooltip" aria-hidden="true">
          <div class="tooltip-content">
            <div class="tooltip-name" id="tooltipName"></div>
            <div class="tooltip-dimensions" id="tooltipDimensions"></div>
          </div>
          <div class="tooltip-arrow"></div>
        </div>
      </main>


      <!-- Right Sidebar - Utilities -->
      <aside class="sidebar-right">
        <!-- Map Controls Section -->
        <div class="map-controls-section">
          <h3 class="section-title" data-i18n="mapa.controls.title">Controles</h3>

          <div class="legend-item" data-control="satellite">
            <input type="checkbox" class="legend-checkbox" id="satToggle" checked />
            <label for="satToggle" class="legend-label" data-i18n="mapa.controls.satellite">Sat√©lite</label>
          </div>

          <div class="legend-item" data-control="grayscale">
            <input type="checkbox" class="legend-checkbox" id="grayToggle" />
            <label for="grayToggle" class="legend-label" data-i18n="mapa.controls.grayscale">Escala Gris</label>
          </div>

          <div class="legend-item" data-control="interest-points">
            <input type="checkbox" class="legend-checkbox" id="interestPointsToggle" checked />
            <label for="interestPointsToggle" class="legend-label" data-i18n="mapa.controls.interest_points">Puntos de Inter√©s</label>
          </div>
        </div>

        <!-- Legend Section -->
        <div class="legend-section">
          <h3 class="section-title" data-i18n="mapa.legend.title">Estado de Lotes</h3>

          <div class="legend-item" data-status="disponible">
            <input
              type="checkbox"
              class="legend-checkbox"
              id="filterDisponible"
              checked
            />
            <div class="legend-color disponible"></div>
            <label for="filterDisponible" class="legend-label" data-i18n="mapa.legend.available">Disponible</label>
            <span class="legend-count" id="countDisponible">0</span>
          </div>

          <div class="legend-item" data-status="reservado">
            <input
              type="checkbox"
              class="legend-checkbox"
              id="filterReservado"
              checked
            />
            <div class="legend-color reservado"></div>
            <label for="filterReservado" class="legend-label" data-i18n="mapa.legend.reserved">Reservado</label>
            <span class="legend-count" id="countReservado">0</span>
          </div>

          <div class="legend-item" data-status="vendido">
            <input
              type="checkbox"
              class="legend-checkbox"
              id="filterVendido"
              checked
            />
            <div class="legend-color vendido"></div>
            <label for="filterVendido" class="legend-label" data-i18n="mapa.legend.sold">Vendido</label>
            <span class="legend-count" id="countVendido">0</span>
          </div>
        </div>

        <!-- Zoom Controls Section -->
        <div class="zoom-section">
          <h3 class="section-title" data-i18n="mapa.controls.zoom">Zoom</h3>
          <div class="zoom-controls">
            <button class="zoom-btn" id="zoomIn" data-i18n-attr="aria-label:mapa.controls.zoom_in" aria-label="Acercar">+</button>
            <button class="zoom-btn" id="zoomOut" data-i18n-attr="aria-label:mapa.controls.zoom_out" aria-label="Alejar">‚àí</button>
          </div>
        </div>
      </aside>
      </div>

      <!-- Mobile Components -->
      <!-- Mobile Floating Action Buttons -->
      <div class="mobile-fabs" id="mobileFabs">
        <button class="mobile-fab" id="mobileMapToggle" data-i18n-attr="aria-label:mapa.mobile.map_toggle" aria-label="Opciones de Mapa" title="Mapa">
          <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.5 3L20.34 3.03L15 5.1L9 3L3.36 4.9C3.15 4.97 3 5.15 3 5.38V20.5C3 20.78 3.22 21 3.5 21L3.66 20.97L9 18.9L15 21L20.64 19.1C20.85 19.03 21 18.85 21 18.62V3.5C21 3.22 20.78 3 20.5 3ZM15 19L9 17V5L15 7V19Z" fill="currentColor"/>
          </svg>
        </button>
        <button class="mobile-fab" id="mobileLegendToggle" data-i18n-attr="aria-label:mapa.mobile.legend_toggle" aria-label="Estado de Lotes" title="Leyenda">
          <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 17H9V15H3V17ZM3 13H9V11H3V13ZM3 9H9V7H3V9ZM11 17H21V15H11V17ZM11 13H21V11H11V13ZM11 9H21V7H11V9ZM11 5H21V3H11V5ZM3 5H9V3H3V5Z" fill="currentColor"/>
          </svg>
        </button>
        <button class="mobile-fab active" id="mobileInterestPointsToggle" data-i18n-attr="aria-label:mapa.mobile.interest_points_toggle" aria-label="Puntos de Inter√©s" title="Puntos de Inter√©s">
          <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="currentColor"/>
          </svg>
        </button>
      </div>

      <!-- Mobile Bottom Parcel Card -->
      <div class="mobile-parcel-card" id="mobileParcelCard">
        <!-- Close button positioned in top-right corner -->
        <button class="mobile-card-close" id="mobileCardClose" data-i18n-attr="aria-label:mapa.mobile.close" aria-label="Cerrar">
          &times;
        </button>

        <div class="mobile-card-content">
          <div class="mobile-card-image">
            <img id="mobileCardImage" src="" alt="Imagen del lote" />
          </div>
          <div class="mobile-card-details">
            <h3 class="mobile-card-title" id="mobileCardTitle">Lote N/A</h3>
            <span class="mobile-card-status" id="mobileCardStatus" data-i18n="mapa.sidebar.status.disponible">Disponible</span>
            <p class="mobile-card-location" id="mobileCardLocation">Colonia Independencia</p>
            <p class="mobile-card-coordinates" id="mobileCardCoordinates">N/A, N/A</p>
            <p class="mobile-card-price" id="mobileCardPrice" data-i18n="mapa.sidebar.labels.consult">Consultar</p>
          </div>
        </div>

        <div class="mobile-card-actions">
          <button class="mobile-reserve-btn" id="mobileReserveBtn" data-i18n="mapa.mobile.reserve">Reservar</button>
        </div>
      </div>

      <!-- Mobile Bottom Sheets -->
      <!-- Map Options Bottom Sheet -->
      <div class="mobile-bottom-sheet-backdrop" id="mapSheetBackdrop"></div>
      <div class="mobile-bottom-sheet" id="mapBottomSheet">
        <div class="mobile-bottom-sheet-header">
          <div class="mobile-bottom-sheet-handle"></div>
          <h3 class="mobile-bottom-sheet-title" data-i18n="mapa.mobile.map_options">Opciones de Mapa</h3>
        </div>
        <div class="mobile-bottom-sheet-content">
          <div class="mobile-sheet-option" id="mobileSatelliteOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileSatToggle" checked />
            <label for="mobileSatToggle" class="mobile-sheet-label" data-i18n="mapa.controls.satellite">Sat√©lite</label>
          </div>
          <div class="mobile-sheet-option" id="mobileGrayscaleOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileGrayToggle" />
            <label for="mobileGrayToggle" class="mobile-sheet-label" data-i18n="mapa.mobile.grayscale_label">Escala de Grises</label>
          </div>

          <!-- Language Selector for Mobile -->
          <div class="mobile-sheet-divider"></div>
          <h4 class="mobile-sheet-subtitle" data-i18n="mapa.mobile.language_selector">Seleccionar idioma</h4>
          <div class="mobile-language-selector">
            <button class="mobile-lang-btn active" data-lang="es" aria-label="Espa√±ol">üá™üá∏ Espa√±ol</button>
            <button class="mobile-lang-btn" data-lang="en" aria-label="English">üá∫üá∏ English</button>
            <button class="mobile-lang-btn" data-lang="de" aria-label="Deutsch">üá©üá™ Deutsch</button>
          </div>
        </div>
      </div>

      <!-- Legend Bottom Sheet -->
      <div class="mobile-bottom-sheet-backdrop" id="legendSheetBackdrop"></div>
      <div class="mobile-bottom-sheet" id="legendBottomSheet">
        <div class="mobile-bottom-sheet-header">
          <div class="mobile-bottom-sheet-handle"></div>
          <h3 class="mobile-bottom-sheet-title" data-i18n="mapa.mobile.lot_status">Estado de Lotes</h3>
        </div>
        <div class="mobile-bottom-sheet-content">
          <div class="mobile-sheet-option" id="mobileDisponibleOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileFilterDisponible" checked />
            <div class="mobile-sheet-color disponible"></div>
            <label for="mobileFilterDisponible" class="mobile-sheet-label" data-i18n="mapa.legend.available">Disponible</label>
            <span class="mobile-sheet-count" id="mobileCountDisponible">0</span>
          </div>
          <div class="mobile-sheet-option" id="mobileReservadoOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileFilterReservado" checked />
            <div class="mobile-sheet-color reservado"></div>
            <label for="mobileFilterReservado" class="mobile-sheet-label" data-i18n="mapa.legend.reserved">Reservado</label>
            <span class="mobile-sheet-count" id="mobileCountReservado">0</span>
          </div>
          <div class="mobile-sheet-option" id="mobileVendidoOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileFilterVendido" checked />
            <div class="mobile-sheet-color vendido"></div>
            <label for="mobileFilterVendido" class="mobile-sheet-label" data-i18n="mapa.legend.sold">Vendido</label>
            <span class="mobile-sheet-count" id="mobileCountVendido">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Interest Modal -->
    <div class="interest-modal-backdrop" id="interestModalBackdrop"></div>
    <div class="interest-modal" id="interestModal">
      <div class="interest-modal-content">
        <div class="interest-modal-header">
          <h2 class="interest-modal-title" data-i18n="mapa.interest_modal.title">Registro de inter√©s</h2>
          <button class="interest-modal-close" id="interestModalClose" data-i18n-attr="aria-label:mapa.sidebar.close" aria-label="Cerrar">
            &times;
          </button>
        </div>

        <div class="interest-modal-body">
          <p class="interest-modal-description" data-i18n="mapa.interest_modal.description">
            Dej√° tus datos y te contactaremos para informarte sobre este lote.
          </p>

          <form id="interestForm" class="interest-form">
            <div class="interest-form-group">
              <label for="contactName" class="interest-form-label" data-i18n="mapa.interest_modal.contact_name_label">Nombre</label>
              <input
                type="text"
                id="contactName"
                name="contactName"
                class="interest-form-input"
                data-i18n-attr="placeholder:mapa.interest_modal.contact_name_placeholder"
                placeholder="Tu nombre completo"
                required
                minlength="2"
              />
              <span class="interest-form-error" id="contactNameError"></span>
            </div>

            <div class="interest-form-group">
              <label for="contactPhone" class="interest-form-label" data-i18n="mapa.interest_modal.contact_phone_label">Tel√©fono</label>
              <input
                type="tel"
                id="contactPhone"
                name="contactPhone"
                class="interest-form-input"
                data-i18n-attr="placeholder:mapa.interest_modal.contact_phone_placeholder"
                placeholder="+595 xxx xxx xxx"
                required
                minlength="6"
              />
              <span class="interest-form-error" id="contactPhoneError"></span>
            </div>

            <div class="interest-form-actions">
              <button
                type="button"
                class="interest-btn interest-btn-secondary"
                id="interestCancelBtn"
                data-i18n="mapa.interest_modal.cancel_button"
              >
                Cancelar
              </button>
              <button
                type="submit"
                class="interest-btn interest-btn-primary"
                id="interestSubmitBtn"
                data-i18n="mapa.interest_modal.submit_button"
              >
                Enviar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Libraries -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/togeojson@0.16.0"></script>

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Internationalization -->
    <script src="assets/js/i18n.js"></script>

    <!-- Supabase Integration -->
    <script src="assets/js/supabase-client.js"></script>
    <script src="assets/js/loteamiento-service.js"></script>
    <script src="assets/js/lote-service.js"></script>
    <script src="assets/js/interest-service.js"></script>

    <!-- Map Application -->
    <script src="assets/js/mapa.js"></script>

    <!-- Interest Points Feature -->
    <script src="assets/js/interest-points.js"></script>
  </body>
</html>
