<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mapa Loteamiento - Mega Proyectos</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="assets/css/index.css" />
    <link rel="stylesheet" href="assets/css/mapa.css" />
  </head>
  <body>
    <div class="map-layout">
      <!-- Header -->
      <header class="map-header">
        <a href="index.html" class="map-back-button" aria-label="Volver a inicio">
          <span class="back-arrow">‚Üê</span>
        </a>
        <h1 class="map-title">Loteamiento Colonia Independencia</h1>
      </header>

      <!-- Map Content Container -->
      <div class="map-content">
        <!-- Left Sidebar - Info Panel -->
        <aside class="sidebar-left" id="sidebarLeft">
        <div class="sidebar-header">
          <h2 class="sidebar-title">Informaci√≥n del Lote</h2>
          <button class="sidebar-close" id="sidebarClose" aria-label="Cerrar">
            &times;
          </button>
        </div>

        <div class="sidebar-content">
          <!-- Empty State -->
          <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">üó∫Ô∏è</div>
            <h3>Selecciona un Lote</h3>
            <p>
              Haz clic en cualquier lote del mapa para ver informaci√≥n
              detallada, incluyendo precio, dimensiones y estado de
              disponibilidad.
            </p>
          </div>

          <!-- Parcel Information -->
          <div class="parcel-info" id="parcelInfo">
            <div class="parcel-image">
              <img id="parcelImage" src="" alt="Imagen del lote" />
            </div>

            <span class="status-badge" id="parcelStatusBadge">Disponible</span>

            <div class="info-section">
              <div class="info-label">Nombre</div>
              <div class="info-value" id="parcelName">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label">Descripci√≥n</div>
              <div class="info-value" id="parcelDescription">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label">Lados</div>
              <div class="info-value" id="parcelLados">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label">Coordenadas</div>
              <div class="info-value" id="parcelCoordinates">N/A</div>
            </div>

            <div class="info-section">
              <div class="info-label">√Årea (m¬≤)</div>
              <div class="info-value" id="parcelArea">N/A</div>
            </div>

            <div class="price-display">
              <div class="info-label">Precio</div>
              <div class="price-amount" id="parcelPrice">Consultar</div>
            </div>

            <button class="reserve-btn" id="reserveBtn">Reservar Lote</button>
          </div>
        </div>
      </aside>

      <!-- Center - Map Container -->
      <main class="map-container">
        <div id="map"></div>
        
        <!-- Tooltip Container -->
        <div id="parcelTooltip" class="parcel-tooltip" role="tooltip" aria-hidden="true">
          <div class="tooltip-content">
            <div class="tooltip-name" id="tooltipName"></div>
            <div class="tooltip-dimensions" id="tooltipDimensions"></div>
          </div>
          <div class="tooltip-arrow"></div>
        </div>
      </main>


      <!-- Right Sidebar - Utilities -->
      <aside class="sidebar-right">
        <!-- Map Controls Section -->
        <div class="map-controls-section">
          <h3 class="section-title">Controles</h3>

          <div class="legend-item" data-control="satellite">
            <input type="checkbox" class="legend-checkbox" id="satToggle" checked />
            <label for="satToggle" class="legend-label">Sat√©lite</label>
          </div>

          <div class="legend-item" data-control="grayscale">
            <input type="checkbox" class="legend-checkbox" id="grayToggle" />
            <label for="grayToggle" class="legend-label">Escala Gris</label>
          </div>

          <div class="legend-item" data-control="interest-points">
            <input type="checkbox" class="legend-checkbox" id="interestPointsToggle" checked />
            <label for="interestPointsToggle" class="legend-label">Puntos de Inter√©s</label>
          </div>
        </div>

        <!-- Legend Section -->
        <div class="legend-section">
          <h3 class="section-title">Estado de Lotes</h3>

          <div class="legend-item" data-status="disponible">
            <input
              type="checkbox"
              class="legend-checkbox"
              id="filterDisponible"
              checked
            />
            <div class="legend-color disponible"></div>
            <label for="filterDisponible" class="legend-label"
              >Disponible</label
            >
            <span class="legend-count" id="countDisponible">0</span>
          </div>

          <div class="legend-item" data-status="reservado">
            <input
              type="checkbox"
              class="legend-checkbox"
              id="filterReservado"
              checked
            />
            <div class="legend-color reservado"></div>
            <label for="filterReservado" class="legend-label">Reservado</label>
            <span class="legend-count" id="countReservado">0</span>
          </div>

          <div class="legend-item" data-status="vendido">
            <input
              type="checkbox"
              class="legend-checkbox"
              id="filterVendido"
              checked
            />
            <div class="legend-color vendido"></div>
            <label for="filterVendido" class="legend-label">Vendido</label>
            <span class="legend-count" id="countVendido">0</span>
          </div>
        </div>

        <!-- Interest Points Section -->
        <div class="interest-points-section" id="interestPointsSection">
          <h3 class="section-title">Puntos de Inter√©s</h3>
          <div class="interest-points-list" id="interestPointsList">
            <!-- Dynamically populated by JavaScript -->
          </div>
        </div>

        <!-- Zoom Controls Section -->
        <div class="zoom-section">
          <h3 class="section-title">Zoom</h3>
          <div class="zoom-controls">
            <button class="zoom-btn" id="zoomIn" aria-label="Acercar">+</button>
            <button class="zoom-btn" id="zoomOut" aria-label="Alejar">‚àí</button>
          </div>
        </div>
      </aside>
      </div>

      <!-- Mobile Components -->
      <!-- Mobile Floating Action Buttons -->
      <div class="mobile-fabs" id="mobileFabs">
        <button class="mobile-fab" id="mobileMapToggle" aria-label="Opciones de Mapa" title="Mapa">
          <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.5 3L20.34 3.03L15 5.1L9 3L3.36 4.9C3.15 4.97 3 5.15 3 5.38V20.5C3 20.78 3.22 21 3.5 21L3.66 20.97L9 18.9L15 21L20.64 19.1C20.85 19.03 21 18.85 21 18.62V3.5C21 3.22 20.78 3 20.5 3ZM15 19L9 17V5L15 7V19Z" fill="currentColor"/>
          </svg>
        </button>
        <button class="mobile-fab" id="mobileLegendToggle" aria-label="Estado de Lotes" title="Leyenda">
          <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 17H9V15H3V17ZM3 13H9V11H3V13ZM3 9H9V7H3V9ZM11 17H21V15H11V17ZM11 13H21V11H11V13ZM11 9H21V7H11V9ZM11 5H21V3H11V5ZM3 5H9V3H3V5Z" fill="currentColor"/>
          </svg>
        </button>
        <button class="mobile-fab" id="mobileInterestToggle" aria-label="Puntos de Inter√©s" title="Puntos de Inter√©s">
          <svg class="fab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="currentColor"/>
          </svg>
        </button>
      </div>

      <!-- Mobile Bottom Parcel Card -->
      <div class="mobile-parcel-card" id="mobileParcelCard">
        <!-- Close button positioned in top-right corner -->
        <button class="mobile-card-close" id="mobileCardClose" aria-label="Cerrar">
          &times;
        </button>
        
        <div class="mobile-card-content">
          <div class="mobile-card-image">
            <img id="mobileCardImage" src="" alt="Imagen del lote" />
          </div>
          <div class="mobile-card-details">
            <h3 class="mobile-card-title" id="mobileCardTitle">Lote N/A</h3>
            <span class="mobile-card-status" id="mobileCardStatus">Disponible</span>
            <p class="mobile-card-location" id="mobileCardLocation">Colonia Independencia</p>
            <p class="mobile-card-coordinates" id="mobileCardCoordinates">N/A, N/A</p>
            <p class="mobile-card-price" id="mobileCardPrice">Consultar</p>
          </div>
        </div>
        
        <div class="mobile-card-actions">
          <button class="mobile-reserve-btn" id="mobileReserveBtn">Reservar</button>
        </div>
      </div>

      <!-- Mobile Bottom Sheets -->
      <!-- Map Options Bottom Sheet -->
      <div class="mobile-bottom-sheet-backdrop" id="mapSheetBackdrop"></div>
      <div class="mobile-bottom-sheet" id="mapBottomSheet">
        <div class="mobile-bottom-sheet-header">
          <div class="mobile-bottom-sheet-handle"></div>
          <h3 class="mobile-bottom-sheet-title">Opciones de Mapa</h3>
        </div>
        <div class="mobile-bottom-sheet-content">
          <div class="mobile-sheet-option" id="mobileSatelliteOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileSatToggle" checked />
            <label for="mobileSatToggle" class="mobile-sheet-label">Sat√©lite</label>
          </div>
          <div class="mobile-sheet-option" id="mobileGrayscaleOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileGrayToggle" />
            <label for="mobileGrayToggle" class="mobile-sheet-label">Escala de Grises</label>
          </div>
        </div>
      </div>

      <!-- Legend Bottom Sheet -->
      <div class="mobile-bottom-sheet-backdrop" id="legendSheetBackdrop"></div>
      <div class="mobile-bottom-sheet" id="legendBottomSheet">
        <div class="mobile-bottom-sheet-header">
          <div class="mobile-bottom-sheet-handle"></div>
          <h3 class="mobile-bottom-sheet-title">Estado de Lotes</h3>
        </div>
        <div class="mobile-bottom-sheet-content">
          <div class="mobile-sheet-option" id="mobileDisponibleOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileFilterDisponible" checked />
            <div class="mobile-sheet-color disponible"></div>
            <label for="mobileFilterDisponible" class="mobile-sheet-label">Disponible</label>
            <span class="mobile-sheet-count" id="mobileCountDisponible">0</span>
          </div>
          <div class="mobile-sheet-option" id="mobileReservadoOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileFilterReservado" checked />
            <div class="mobile-sheet-color reservado"></div>
            <label for="mobileFilterReservado" class="mobile-sheet-label">Reservado</label>
            <span class="mobile-sheet-count" id="mobileCountReservado">0</span>
          </div>
          <div class="mobile-sheet-option" id="mobileVendidoOption">
            <input type="checkbox" class="mobile-sheet-checkbox" id="mobileFilterVendido" checked />
            <div class="mobile-sheet-color vendido"></div>
            <label for="mobileFilterVendido" class="mobile-sheet-label">Vendido</label>
            <span class="mobile-sheet-count" id="mobileCountVendido">0</span>
          </div>
        </div>
      </div>

      <!-- Interest Points Bottom Sheet -->
      <div class="mobile-bottom-sheet-backdrop" id="interestSheetBackdrop"></div>
      <div class="mobile-bottom-sheet" id="interestBottomSheet">
        <div class="mobile-bottom-sheet-header">
          <div class="mobile-bottom-sheet-handle"></div>
          <h3 class="mobile-bottom-sheet-title">Puntos de Inter√©s</h3>
        </div>
        <div class="mobile-bottom-sheet-content" id="mobileInterestPointsList">
          <!-- Dynamically populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Libraries -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/togeojson@0.16.0"></script>

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase Integration -->
    <script src="assets/js/supabase-client.js"></script>
    <script src="assets/js/loteamiento-service.js"></script>
    <script src="assets/js/lote-service.js"></script>

    <!-- Map Application -->
    <script src="assets/js/mapa.js"></script>

    <!-- Interest Points Feature -->
    <script src="assets/js/interest-points.js"></script>
  </body>
</html>
